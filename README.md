# Finance Copilot Web

## 项目简介
**Finance Copilot Web** 是一款智能化的财务报表录入与管理系统，旨在通过对话式交互（Conversational UI）和自动化工具，简化复杂的财务数据录入流程。系统采用 Next.js 16 构建，集成了 OCR 识别、智能校验、AI 报告生成等功能，为用户提供从“客户选择”到“报表完成”的全流程辅助。

## 核心业务流程
项目围绕 **“5步录入法”** 进行设计，确保数据录入的准确性与规范性：
1.  **选择客户**：从客户列表中锁定目标主体。
2.  **填写基本信息**：录入报表性质、周期、类型及审计信息（事务所、审计意见等）。
3.  **上传识别报表**（可选）：支持扫描仪、Excel、PDF、图片等多种格式导入，利用 OCR 技术自动提取数据。
4.  **校验报表**：
    *   **影像/数据对照**：左侧展示报表影像（支持缩放、旋转、分页），右侧进行数据核对。
    *   **智能平衡校验**：系统自动检测科目间的计算关系（如：资产=负债+所有者权益）。
5.  **完成录入**：最终确认并生成正式记录。

## 核心功能亮点
*   **🤖 对话式交互 (Chat UI)**：
    *   采用 ChatContainer 架构，通过自然语言或快捷卡片（Quick Actions）引导用户完成操作。
    *   支持步骤流转控制，通过 `use-chat` hook 管理录入进度。
*   **📊 强大的报表管理**：
    *   支持多种报表类型（小企业/企业2019版等）和周期（年/季/月报）。
    *   状态全周期追踪（已确认/未确认、审计状态）。
*   **👁️ 可视化校验工作台**：
    *   提供分屏视图，左侧影像查看器支持 Excel 预览及图片处理（拖拽、高亮）。
    *   右侧动态表单支持“录入项”、“计算项”和“其他项”的智能区分与联动。
*   **🧠 AI 赋能**：
    *   **AI 报告生成**：异步任务生成专业的财务分析报告，支持状态追踪与下载。
    *   **OCR 辅助**：自动识别报表科目与金额，减少人工录入成本。

## 技术架构
该项目基于现代化的前端技术栈构建，注重性能与开发体验：

*   **核心框架**：Next.js 16.1.1 (App Router) + React 19
*   **开发语言**：TypeScript
*   **样式方案**：Tailwind CSS v4 + Shadcn UI (基于 Radix UI)
*   **状态管理**：Zustand (支持持久化存储，管理 Report 和 Chat 状态)
*   **API 模拟**：MSW (Mock Service Worker) 实现完善的前端独立开发环境
*   **图标库**：Lucide React
*   **工具库**：date-fns (日期处理), framer-motion (动画交互), sonner (Toast 通知)

## 部署与Mock数据
如果需要在服务器部署后（生产环境）依然使用 Mock 数据（例如用于演示环境），请按照以下步骤操作：

1. **构建带 Mock 的版本**
   在构建项目时，需要设置 `NEXT_PUBLIC_API_MOCK=true` 环境变量。
   
   我们已经在 `package.json` 中提供了便捷命令：
   ```bash
   npm run build:mock
   # 或者使用 pnpm
   pnpm build:mock
   ```

2. **环境变量配置（Vercel/Docker）**
   如果您使用 CI/CD 流水线，请确保在构建阶段（Build Time）设置环境变量：
   - `NEXT_PUBLIC_API_MOCK=true`

   > 注意：`NEXT_PUBLIC_` 变量会在构建时被内联到客户端代码中，因此必须在构建时设置，而非仅在运行时设置。

3. **验证**
   部署完成后，打开浏览器控制台（Console），如果看到 `[MSW] Mocking enabled.` 的提示，说明 Mock 服务已成功启动。

## 项目目录结构
```text
finance-copilot-web/
├── app/                  # Next.js App Router 路由与页面
├── src/
│   ├── api/              # API 客户端与 OpenAPI Schema
│   ├── components/       # 组件库
│   │   ├── chat/         # 聊天交互组件 (ChatContainer, MessageBubble)
│   │   ├── report/       # 报表业务组件 (Forms, Modals)
│   │   └── ui/           # 基础 UI 组件 (Button, Input, Calendar)
│   ├── constants/        # 常量定义 (flow.ts 定义业务流程)
│   ├── hooks/            # 自定义 Hooks (use-chat 核心逻辑)
│   ├── mocks/            # MSW Mock 服务处理程序
│   ├── store/            # Zustand 状态管理 (chat-store, report-store)
│   └── types/            # TypeScript 类型定义
└── public/               # 静态资源与 MSW Worker
```

---

## 详细产品说明（开发参考）

```
**功能设计**
我要做的产品是录入报表，一个分为五个步骤依次是：“选择客户”->“填写基本信息”->“上传识别报表（非必要）”->“校验报表”->“完成录入”。
我计划把UI设计成对话问答式录入，我可以通过对话的形式完成录入，也可以通过对话的形式获取另外的信息（这个信息后续会拓展，暂时写死），
可以点击输入框顶部的卡片按钮进行快速发送获取到对应关键步骤的内容。
**UI设计**
UI设计规范只需要考虑Pc端的情况，交互逻辑需要考虑到用户的操作习惯。例如：用户可以通过点击卡片按钮快速获取到对应步骤的内容，也可以通过输入框输入文字进行正常的对话。
**动画设计**
需要一些动画效果来提升用户体验。例如：在用户点击卡片按钮时，卡片按钮会有一个缩放效果，提示用户这是一个可点击的区域。在用户输入文字后，输入框会有一个平滑的滚动效果，确保用户可以看到最新的消息。
**开发要求**
在写代码时，需要注释好每一个功能点，方便后续的维护和拓展。安装依赖统一使用pnpm安装。
--------
以上是产品的功能设计和UI设计规范，我需要根据这些规范开始开发。
**开始开发**

##### 新增财报，填写基本信息，审计信息
现在开发点击新增财务报告的模块，该模块需要提交两个表单，首先填写基本信息，提交后填写审计信息。其中基本信息表单包括：报表性质（提供报表性质下拉选择（汇总报表、总公司报表、本部报表、合并报表）），报表周期（提供报表周期下拉选择（年报、半年报、季报、月报）），报表类型（）提供报表类型下拉选择（小企业财务报表、企业财务报表格式（已执行新金融准则，新收入准则和新租赁准则）2019年版、企业财务报表格式（未执行新金融准则，新收入准则和新租赁准则）2019年版等），货币类型（下拉选择货币），报表期次（选择区间为当前年份前后五年，选到年月，如：202505，202403），社会统一信用代码显示（展示客户的社会统一信用代码（只读，不可修改））。审计信息包括：金额单位选择（提供金额单位下拉选择（元、千元、万元、百万、亿）），金额保留小数位数选择（提供小数位数选择（0位小数点、2位小数点）），是否已审计选择（提供是否审计选项选择（是、否）），当是否已审计选择为否时，以下内容置灰，不可选择。审计日期选择（审计日期选择	提供日期选择器，选择格式为年-月-日），审计报告编号（提供审计报告名称输入框），审计会计事务所选择（提供审计会计事务所下拉选择框），审计意见选择（提供审计意见下拉选择框，选项包括无保留意见、带强调事项段或其他事项段的无保留意见、保留意见、否定意见、无法表示意见），查验码输入（提供查验码输入框），无审计报告原因输入（当选择未审计时显示，提供文本输入框，限制200字以内）。在提交基本信息和审计信息都会进行请求网络请求。基本信息请求参数为基本信息的表单内容+客户名称+USER_INFO。返回结果为：提交成功的后的状态和本次录入财报编号。审计信息请求参数为审计信息提交的表单内容，要注意的是当设计信息为否时，因为有部分提交的置灰不可点击了，那几个字段传空值+客户名称+USER_INFO。返回信息为提交成功状态：success。需要建立一个全局状态管理来将这些数据进行管理，以便于在点开按钮时反显内容，后续为了验证完整的录入流程也会校验这些数据，还需要用到zustand状态持久化。的该模块底部设计两个按钮：校验财报，导入报表，当没有提交基本信息和审计信息时不可点击。模块使用shadcn提供的UI组件，写好注释，现在开始开发。

优化：
继续优化功能：1.审计信息中金额单位默认选中元，金额保留小数位数默认选中0位。2.在卡片按钮中，点击【新增财务报表】，【基本信息录入】都是显示显示基本信息和审计信息（和目前功能一致），区别是：点击【新增财务报告】不用反显提交的表单数据，点击【基本信息录入】反显表单内容，若新增财务报告成功，则再点击【基本信息录入】时，会进行用户新增了一条财报录入的语义化回答，并反显最新的内容。3.卡片按钮中的【客户锁定】按钮也需要通过zustand管理并做持久化处理。4.删除卡片表格中的【搜索客户】按钮，将搜索客户移动到客户列表模块中，根据代码情况修改或新增接口以满足搜索客户的需求。设计ui组件的使用shadcn，代码进行注释。
继续对基础信息，审计信息进行优化。1.找出填写表单时卡顿问题并解决。2.表单提交成功和点击按钮的网页提示，通过shadcn提供的组件显示。3.逻辑调整：基本信息录入反显的内容为新增财务报表提交成功后的数据，若新增财务报表没有完成基本信息和审计信息的提交则点击基本信息录入时依旧反显已经提交成功的数据。

##### 校验财报页面开发：
现在开始开发校验财报模块。该模块可以在进行基本信息和审计信息提交后点击底部校验财报按钮进入，也可以通过底部校验财报卡片按钮进入，需要注意的是：通过底部卡片按钮进入时需要满足条件是zustand中有客户名，有填写基本信息和审计信息，以及提交基本信息成功后返回的reportId。该模块是一个全屏的页面，所以需要有一个可以打开关闭的页面，需要考虑页面性能，打开关闭的流畅度。UI组件使用shadcn，模块内容暂时为空，我验收后再进行后续开发。

现在开始开发财报校验模块的页面，页面分为左右两部分，左边展示报表影像展示区域，右边是校验结果的展示区域。左侧详细功能：通过资产负债表，利润表，现金流量表切换展示不同的报表影像，每个报表需要展示状态，如：资产负债表（未上传报表）/资产负债表（校验成功）/资产负债表（校验失败）,校验成功或失败需要有颜色进行区分。成功默认蓝色，失败为红色。影像区域分为三种情况：未上传报表时显示：未上传《xxx》相关影像，并提供上传按钮。上传报表时：若上传类型为excel，需要展示excel，若excel宽高超出区域，需要做优化处理；若上传类型为图像，展示的图像需要满足拖动，缩放，当前缩放百分比，可能会有多张图片，因此需要加入分页器进行切换。已经上传报表的情况，可以通过点击上传有误按钮重新替换当前的影像。以上是左侧区域当前的功能。右侧区域为校验区域，顶部通过下拉选择框切换当前识别列，识别列是识别到影像中的金额数据，一般有多列，例如影像中有期初余额，期末余额，则识别列下拉选项为期初余额，期末余额，默认选中期末余额。当没有上传影像时，默认选中期末余额。在下拉框下方是识别结果的表格，表头为：序号，项目科目，本期报告（单位：元），操作。表格数据先模拟，操作选项后续添加。现在开始实现。

优化校验财报页面：1.页面组件恢复为shadcn提供的组件。2.不显示DialogHeader，只显示DialogContent。在右侧区域显示客户名称，关闭按钮，左右头部区域高度保持一致。3.左侧图片影像可以通过控制鼠标滚轮进行缩放。

未执行模板科目


```
